<script>
  async function gerarPix() {
    try {
      const resposta = await fetch("/gerar-pix", { method: "POST" });
      const dados = await resposta.json();

      if (dados.qrCode && dados.copiaCola) {
        document.getElementById("pixArea").innerHTML = `
          <img src="${dados.qrCode}" alt="QR Code Pix" />
          <div class="copy-area">
            <p><strong>Copia e Cola:</strong></p>
            <textarea rows="2" style="width: 100%;">${dados.copiaCola}</textarea>
          </div>
        `;
      } else {
        document.getElementById("pixArea").innerHTML = `
          <p style="color: red;">Erro ao gerar QR Code: ${dados.error || 'desconhecido'}</p>
        `;
      }

    } catch (err) {
      document.getElementById("pixArea").innerHTML = `
        <p style="color: red;">Erro ao conectar com o servidor: ${err.message}</p>
      `;
    }
  }

  function iniciarContador(segundos) {
    const timer = document.getElementById("timer");
    const intervalo = setInterval(() => {
      let min = String(Math.floor(segundos / 60)).padStart(2, '0');
      let sec = String(segundos % 60).padStart(2, '0');
      timer.textContent = `${min}:${sec}`;
      if (segundos <= 0) {
        clearInterval(intervalo);
        window.location.href = "/";
      }
      segundos--;
    }, 1000);
  }

  gerarPix();
  iniciarContador(900);
</script>
